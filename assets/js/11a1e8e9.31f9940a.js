"use strict";(self.webpackChunklinkis_web_apache=self.webpackChunklinkis_web_apache||[]).push([[6369],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return h}});var i=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},r=Object.keys(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=i.createContext({}),p=function(e){var t=i.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(a),h=n,f=u["".concat(s,".").concat(h)]||u[h]||d[h]||r;return a?i.createElement(f,o(o({ref:t},c),{},{components:a})):i.createElement(f,o({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,o=new Array(r);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var p=2;p<r;p++)o[p]=a[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,a)}u.displayName="MDXCreateElement"},91986:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return c},default:function(){return u}});var i=a(87462),n=a(63366),r=(a(67294),a(3905)),o=["components"],l={title:"ResultSet File Storage",sidebar_position:3},s=void 0,p={unversionedId:"architecture/storage/resultset-file",id:"version-0.11.0/architecture/storage/resultset-file",isDocsHomePage:!1,title:"ResultSet File Storage",description:"Result set file storage scheme-Dolphin file",source:"@site/versioned_docs/version-0.11.0/architecture/storage/resultset-file.md",sourceDirName:"architecture/storage",slug:"/architecture/storage/resultset-file",permalink:"/docs/0.11.0/architecture/storage/resultset-file",editUrl:"https://github.com/apache/incubator-linkis-website/edit/dev/versioned_docs/version-0.11.0/architecture/storage/resultset-file.md",tags:[],version:"0.11.0",sidebarPosition:3,frontMatter:{title:"ResultSet File Storage",sidebar_position:3},sidebar:"version-1.0.2/tutorialSidebar",previous:{title:"Access Remote File System Architecture",permalink:"/docs/0.11.0/architecture/storage/remote-file-system-architecture-design"},next:{title:"UJES Design",permalink:"/docs/0.11.0/architecture/ujes/ujes-design"}},c=[{value:"1 Background",id:"1-background",children:[]},{value:"2 Ideas",id:"2-ideas",children:[]},{value:"3 Implementation",id:"3-implementation",children:[{value:"3.1 Write data to Dolphin",id:"31-write-data-to-dolphin",children:[]},{value:"3.2 Read Dolphin file",id:"32-read-dolphin-file",children:[]},{value:"3.3 Skip",id:"33-skip",children:[]},{value:"3.4 Serialization",id:"34-serialization",children:[]}]}],d={toc:c};function u(e){var t=e.components,l=(0,n.Z)(e,o);return(0,r.kt)("wrapper",(0,i.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Result set file storage scheme-Dolphin file")),(0,r.kt)("h2",{id:"1-background"},"1 Background"),(0,r.kt)("p",null,"Linkis faces the need to store multiple types of data in files, such as storing Hive table data in files, and hopes to save metadata information such as field types, column names, and comments."),(0,r.kt)("p",null,"Existing file storage solutions generally only support specific data types for storage. For example, ORC supports data tables but does not support the storage of unstructured data."),(0,r.kt)("p",null,"At the same time, support for saving special characters is also the reason that prompted us to define a new file format. For example, if there are special characters such as line breaks in a field in textFile, the content will be abnormal when it is parsed and read."),(0,r.kt)("p",null,"Finally, if the content of the file is too large, Linkis usually hopes to provide a paging function. Existing file storage schemes only support how many bytes are skipped, but do not support how many lines are skipped, or only read a certain line in the file."),(0,r.kt)("h2",{id:"2-ideas"},"2 Ideas"),(0,r.kt)("p",null,"Linkis defines a file storage format Dolphin file that stores multiple data types."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Dolphin file format",src:a(76322).Z})),(0,r.kt)("p",null,"The file structure of Dolphin is shown in the figure above:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The Dolphin logo is stored at the beginning of the file to distinguish whether the file is a Dolphin file")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Metadata: content metadata information")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"index Data: row length index")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"RowData: Row data."),(0,r.kt)("p",{parentName:"li"},"RowData stores a row of data, such as the data of a row of the table, including the length of the row data and the Byte information of the row data.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"PostData: Basic file information")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"PostDataLen: Basic information length"))),(0,r.kt)("p",null,"Among them, PostData is the basic information of the file mainly composed of:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"type: the type of storage content")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Codec: encoding format")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Statistical information: The statistical information of the file content includes the number of lines, the maximum and minimum values, etc."))),(0,r.kt)("h2",{id:"3-implementation"},"3 Implementation"),(0,r.kt)("p",null,"The specific process of reading and writing Dolphin files is as follows:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Dolphin file read and write flow chart",src:a(84793).Z})),(0,r.kt)("h3",{id:"31-write-data-to-dolphin"},"3.1 Write data to Dolphin"),(0,r.kt)("p",null,"When the user needs to store the contents of a file (for example: table) in a Dolphin file, the steps are as follows:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Write Dolphin file ID")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Write data type Type")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Through the serializer (Serializer), write Metadata (metadata) such as the column name of the table, the type of each column, column comments, etc.;")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Pass in a row of data to DolphinWriter, DolphinWriter serializes the row of data through a serializer (Serializer) to obtain the row length and serialized Bytes to write to the Dolphin file;")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"After writing the row of data, it will update the statistical information (Statistical information), increase the number of row records, update the maximum and minimum values \u200b\u200bof each column, etc.;")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"DolphinWriter writes PostData (basic information) composed of statistical information and encoding information to the Dolphin file;")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Write the length of PostData to complete the write operation."))),(0,r.kt)("h3",{id:"32-read-dolphin-file"},"3.2 Read Dolphin file"),(0,r.kt)("p",null,"The steps for users to read the contents of the Dolphin file are as follows:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Read the Dolphin file ID, and throw an exception if it is not a Dolphin file;")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If the user only needs to read Statistical information, read the length of PostData, and obtain PostData according to the length."),(0,r.kt)("p",{parentName:"li"},"Through PostData, the basic information is parsed into corresponding Type, Codec, MetaData, and Statistical information."),(0,r.kt)("p",{parentName:"li"},"Return to complete this reading operation.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If the user wants to read data, first read the data type Type.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Read the Metadata information, get the Deserializer through Type, and encapsulate the read Bytes data into MetaData")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Read the row length index, and read the row Bytes through the row length index. Obtain Deserializer through Type, convert Bytes into Record data, and encapsulate RowData with Record and MetaData;")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The read RowData row content is given to the user to complete the entire reading."))),(0,r.kt)("h3",{id:"33-skip"},"3.3 Skip"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Question"),": How to read a row? How many lines to start reading?"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Answer"),": When writing a row, the row length index will be written first, so that the user can read the index and skip row reading through the row length index when reading;"),(0,r.kt)("h3",{id:"34-serialization"},"3.4 Serialization"),(0,r.kt)("p",null,"The serializer (Serializer) serializes the data into a byte array, and the deserializer (Deserializer) parses the byte array into string data to achieve correct reading and writing of special characters;"),(0,r.kt)("p",null,"Serializer and Deserializer are related to Type. Different data types can define different Serializer and Deserializer."),(0,r.kt)("p",null,"Dolphin provides a common interface for user-defined implementations to support other types of files."))}u.isMDXComponent=!0},76322:function(e,t,a){t.Z=a.p+"assets/images/dolphin_file-02dc6c26b8bc0df9a45f776f5817a290.png"},84793:function(e,t,a){t.Z=a.p+"assets/images/dolphin_progress-6f961646aef7157ca821afaa38d2570e.png"}}]);